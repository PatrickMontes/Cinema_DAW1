<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sedes</title>
    <link th:href="@{/css/bootstrap.css}" rel="stylesheet" />
    <script th:src="@{/js/jquery/jquery.js}" type="text/javascript"></script>
    <script th:src="@{/js/bootstrap/bootstrap.bundle.js}" type="text/javascript"></script>
</head>
<body>
<div class="container">
    <div class="row">
        <div class="col">
            <h1 class="text-center">Lista de Sedes</h1>
            <button type="button" id="btnAgregarSede" class="btn btn-primary" data-toggle="modal" data-target="#agregarSedeModal">
                Agregar Sede
            </button>
            <br>
            <table class="table table-bordered">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Nombre</th>
                    <th>Ubicación</th>
                    <th>Acciones</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="sede : ${sedes}">
                    <td th:text="${sede.sede_id}"></td>
                    <td th:text="${sede.nombre}"></td>
                    <td th:text="${sede.ubicacion}"></td>
                    <td>
                        <button type="button" class="btn btn-warning btn-sm btnActualizar"
                                th:attr="data-id=${sede.sede_id}, data-nombre=${sede.nombre}, data-ubicacion=${sede.ubicacion}"
                                data-toggle="modal" data-target="#actualizarSedeModal">
                            Actualizar
                        </button>
                    </td>
                    <td>
                        <button type="button" class="btn btn-danger btn-sm btnEliminar"
                                th:attr="data-id=${sede.sede_id}">
                            Eliminar
                        </button>
                    </td>

                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
<!-- MODAL AGREGAR SEDE -->
<div class="modal fade" id="agregarSedeModal" tabindex="-1" aria-labelledby="agregarSedeModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="agregarSedeModalLabel">Agregar Sede</h5>
            </div>
            <div class="modal-body">
                <form method="post" action="/guardarSede">
                    <div class="form-group">
                        <label for="nombre">Nombre:</label>
                        <input type="text" class="form-control" id="nombre" name="nombre" required>
                    </div>
                    <div class="form-group">
                        <label for="ubicacion">Ubicación:</label>
                        <input type="text" class="form-control" id="ubicacion" name="ubicacion" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Guardar</button>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn cerrar btn-secondary" data-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>

<!-- MODAL ACTUALIZAR SEDE -->
<div class="modal fade" id="actualizarSedeModal" tabindex="-1" aria-labelledby="actualizarSedeModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="actualizarSedeModalLabel">Actualizar Sede</h5>
            </div>
            <div class="modal-body">
                <form id="actualizarSedeForm" action="/actualizarSede" method="post">
                    <input type="hidden" id="sede_id" name="sede_id">
                    <div class="form-group">
                        <label for="nombreActualizar">Nombre:</label>
                        <input type="text" class="form-control" id="nombreActualizar" name="nombre" required>
                    </div>
                    <div class="form-group">
                        <label for="ubicacionActualizar">Ubicación:</label>
                        <input type="text" class="form-control" id="ubicacionActualizar" name="ubicacion" required>
                    </div>
                    <div class="text-center">
                        <button type="submit" class="btn btn-primary">Actualizar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        $("#btnAgregarSede").click(function () {
            $("#agregarSedeModal").modal('show');
        });
        $(".modal .cerrar").click(function () {
            $(this).closest(".modal").modal('hide');
        });
        $(".btnActualizar").click(function () {
            var sede_id = $(this).data('id');
            var nombre = $(this).data('nombre');
            var ubicacion = $(this).data('ubicacion');

            $("#sede_id").val(sede_id);
            $("#nombreActualizar").val(nombre);
            $("#ubicacionActualizar").val(ubicacion);

            $("#actualizarSedeModal").modal('show');
        });

        $(".btnEliminar").click(function () {
            var sede_id = $(this).data('id');
            if (confirm("¿Estás seguro de que quieres eliminar esta sede?")) {
                $.ajax({
                    type: "POST",
                    url: "/eliminarSede",
                    data: { sede_id: sede_id },
                    success: function () {
                        location.reload();
                    },
                    error: function () {
                        alert("Ha ocurrido un error al intentar eliminar la sede.");
                    }
                });
            }
        });
    });

</script>


</body>
</html>
